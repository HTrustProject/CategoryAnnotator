<html>
	<head>
		
		<meta charset="utf-8">
		
		<title>
			Overlapping Annotations
		</title>
		
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		
		<!--
		The jQuery selectionPlugin is copied from the JavaSriptMVC Project
		[http://javascriptmvc.com/]. It's an easy way to get/set the boundaries
		as indexies of selected text. It works with all elements, also 
		across multiple elements. Now every jQuery object has th additionally
		function .selection() and .selection(start, end). To get the selection
		function running, it depends on range.js and compare.js.
		-->
		<script type="text/javascript" src="js/selectionPlugin/selection.js"></script>
		<script type="text/javascript" src="js/selectionPlugin/range.js"></script>
		<script type="text/javascript" src="js/selectionPlugin/compare.js"></script>
		
		<!--
		The jQuery wrapSelection Plugin [http://archive.plugins.jquery.com/project/wrapSelection]
		makes it possible to easily wrap an span element around an selected
		text. It also works with selections, which are spread across multiple
		elements, so it's generating the affordable amount of span tags,
		which can be styled with CSS. To avoid conflicts betweet the two
		plugins the Range in wrapSelection is now calles WSrange.
		-->
		<script type="text/javascript" src="js/wrapSelectionPlugin/jquery.wrapSelection.js"></script>
		
		<!--
		This jQuery plugin can be found on github. 
		[https://github.com/davatron5000/Lettering.js] Its used for
		getting a hovering effect on single words, to make selections
		easier for the user.
		-->
		<script type="text/javascript" src="js/jquery.lettering-0.6.1.min.js"></script>
		
		<!--
		This jQuery plugin can be found here. 
		[http://pmbennett.net/demos/jquery-finding-lines-of-text.html]
		It wraps each line into a span.
		-->
		<script type="text/javascript" src="js/jquery.wraplines.js"></script>
		
		<!--
		My own written stuff for concept bars.-->
		<script type="text/javascript" src="js/conceptBars/bars.js"></script>
		
		<link rel="stylesheet/less" type="text/css" href="css/layout.less">
		<script src="js/less-1.2.1.min.js" type="text/javascript"></script>
		
		
		<link rel="stylesheet" type="text/css" href="skeleton/base.css" />
		<link rel="stylesheet" type="text/css" href="skeleton/layout.css" />
		<link rel="stylesheet" type="text/css" href="skeleton/skeleton.css" />
		
		<script type='text/javascript'>
			
		var savedClick;
		
		// Start Element, while selecting text.
		var startElement = null;
		var endElement = null;
			
		var textContent;
		
		
		function showMenu(e, endElement){
			
			var x = e.clientX;
			var y = endElement.position().top + endElement.height();
			
			var subpopup =["A", "B", "C", "D"];
						
			$("body").append("<div id='contextmenu' class='popup'></div>");
			$("#contextmenu").css({"top": y+4, "left":x});
			
			// load contextmenu
			$("#contextmenu").load("menu.html", function(){
				
				// load all subPopups, but make them not visible					
				for (s in subpopup){
					
					var id = subpopup[s];
					var subX = $("#contextmenu").width() + 22 - 3;
					var entry = $("#"+id);
					var subY = entry.position().top;
					
					$("body").append("<div id='subpopup_"+id+"' class='popup'></div>");
					$("#subpopup_"+id).css({"top": y+4+subY, "left": x + subX, "display": "none"});
					
					$("#subpopup_"+id).load("sub"+id+".html", function(){
							var divs = $(this).children();
							for (child in divs){
								
								console.log(divs[child]);
								
								// TODO: das mit dem cklick funktioniert nicht
								divs[child].click(function(){
									console.log("click on", divs[child].attr(id));
									
								});
								
							}
							
						});
				}
					
				$(".menuentry").mouseover(function(e){
					
					for (s in subpopup){
						var id = subpopup[s];
						$("#subpopup_"+id).css("display", "none");
					}
					
					var id = $(this).attr("id");
					$("#subpopup_"+id).css("display", "");
				});
			});	
		}
		
		function hoveringWords(){						
			$("#text .word_split span").mousedown(function(){
				
				console.log("span mouseDown");
				
				if (startElement && endElement){
					startElement.removeClass("permanentHover");
					endElement.removeClass("permanentHover");
					startElement = null;
					endElement = null;
				}
				
				startElement = $(this);
				$(this).addClass("permanentHover");
			});
			
			$("#text .word_split span").mouseup(function(){
				
				console.log("span mouseUp");
				
				endElement = $(this);
				$(this).addClass("permanentHover");
			});
		}
		
		$(document).ready(function(){
			
			textContent = $("#text").clone();
			
			// deals with STRG+ and STRG- and STRG0
			// TODO: when size is changed, need to rerender everything
			$(window).keydown(function(event) {
			  if(event.ctrlKey && event.keyCode == 189) { 
				console.log("Hey! Ctrl+- event captured!");
				event.preventDefault(); 
			  }
			  if(event.ctrlKey && event.keyCode == 187) { 
				console.log("Hey! Ctrl++ event captured!");
				event.preventDefault(); 
			  }
			  if(event.ctrlKey && event.keyCode == 48) { 
				console.log("Hey! Ctrl++ event captured!");
				event.preventDefault(); 
			  }
			});
			
			// hover-effect for single words 
			$(".word_split").lettering('words');
			
			// hover-effect on subcategories
			$("li").hover(
				function () {
					$(this).addClass("hover");},
				function () {
					$(this).removeClass("hover");}
			);			
									
			// creating a new annotation
			$("li").click(function(){	
				
				// get rid of the single-word hovering
				$("#text").html(textContent.html());
								
				// add new atom to the atomList, with category and
				// subcategory
				// TODO: look after subcategory
				var category = $(this).parent().parent().attr('id');
				var subcategory = 0;

				addAtomToAtomList(category, savedClick["start"], savedClick["end"]);
								
				// render all bars again and display them
				savedClick = null;
				reset();
				render();
				display();
				
				$(".word_split").lettering('words');
				console.log("Added Lettering.");
				
				hoveringWords();
				console.log("Added hovering.");
			});
			
			// for saving the start/end positions of the selected tex
			$("#text").mouseup(function(e){			
				
				// save the click
				var selectedText = $("#text").selection();
				savedClick = {
					"start":selectedText.start,
					"end":selectedText.end
					};
				
				if(startElement != null &&  endElement != null){
					showMenu(e, endElement);
				}
				
			});
			
			$("html").mousedown(function(e){
				
				console.log("html mouseDown");
				
				if(e.target.nodeName != "SPAN"){
					
					console.log("html no SPAN");
					if(startElement){
						startElement.removeClass("permanentHover");
						startElement = null;
					}
					
					if(endElement){
						endElement.removeClass("permanentHover");
						endElement = null;
					}
				}
			});
			
			hoveringWords();
		});
		</script>
	</head>

	<body>		
		
		<div class="container">
			
				<div class="sixteen columns" style="margin-bottom: 8px; margin-top: 8px;">
						<h2 style="display:inline">overlap</h2>
						<h5 style="display:inline; margin-left:8px;">visualizing overlapping annotations in text.</h5>
				</div>
				
				
				
				<div class="sixteen columns" id="body">
				
					<div class="four columns alpha">
						...
					</div>
				
					<div class="twelve columns omega">
						
						<div class="six columns alpha">
							<div class="category A_underline three columns alpha">
								<h5>Category A</h5>
								<ul>
									<li>Subcategory 1</li>
									<li>Subcategory 2</li>
									<li>Subcategory 3</li>
								</ul>						
							</div>
							<div class="category B_underline three columns omega">
								<h5>Wissenschaft</h5>
								<ul>
									<li>Forschung</li>
									<li>Reisen</li>
									<li>Werke</li>
								</ul>
							</div>
						</div>
						
						<div class="six columns omega">
							
							<div class="category C_underline three columns alpha">
								<h5>Sonstiges</h5>
								<ul>
									<li>Beruf</li>
									<li>Reisen</li>
								</ul>
							</div>
							
							<div class="category D_underline three columns omega">
								<h5>Person</h5>
								<ul>
									<li>Name</li>
									<li>Vorname</li>
									<li>Nachname</li>
									<li>Geburtsort</li>
								</ul>
							</div>											
						</div>															
					</div>
				</div>
				
				<div class="sixteen columns">
					
					<div class="four columns alpha">
						...
					</div>
					
					<!-- This is the div for the text, which is going to be annotated.-->
					<div class="twelve columns omega">
						<h2>Charles Darwin</h2>
						<div id="text">
							<p class="word_split">Charles Robert Darwin war ein britischer Naturforscher. Er gilt wegen seiner wesentlichen Beiträge zur Evolutionstheorie als einer der bedeutendsten Naturwissenschaftler.</p>
							<p class="word_split">Die Ende 1831 begonnene und fast fünf Jahre andauernde Reise mit der HMS Beagle, die den jungen Darwin einmal um die Welt führte, war zugleich Schlüsselerlebnis und Grundlage für sein späteres Werk. Der breiten Öffentlichkeit wurde Darwin erstmals durch seinen 1839 herausgegebenen Reisebericht bekannt. Mit seiner Theorie über die Entstehung der Korallenriffe und weiteren geologischen Schriften erlangte er in wissenschaftlichen Kreisen die Anerkennung als Geologe. Seine Untersuchungen an den Rankenfußkrebsen verschafften ihm Mitte der 1850er Jahre zusätzlich einen angesehenen Ruf als Zoologe und Taxonom.</p>
							<p class="word_split">Bereits 1838 entwarf Darwin seine Theorie der Anpassung an den Lebensraum durch Variation und natürliche Selektion und erklärte so die phylogenetische Entwicklung aller Organismen und ihre Aufspaltung in verschiedene Arten. Über 20 Jahre lang trug er Belege für diese Theorie zusammen. 1842 und 1844 verfasste Darwin kurze Abrisse seiner Theorie, die er jedoch nicht veröffentlichte. Ab 1856 arbeitete er an einem umfangreichen Manuskript mit dem Titel Natural Selection. Durch einen Brief von Alfred Russel Wallace, der dessen Ternate-Manuskript mit ähnlichen Gedanken zur Evolution enthielt, kam es im Sommer 1858 schließlich zu einer Veröffentlichung der Theorien über die Evolution durch die beiden Männer. Ein Jahr später folgte Darwins Hauptwerk On the Origin of Species (Die Entstehung der Arten), das als streng naturwissenschaftliche Erklärung für die Diversität des Lebens die Grundlage der modernen Evolutionsbiologie bildet und einen entscheidenden Wendepunkt in der Geschichte der modernen Biologie darstellt.</p>
							<p class="word_split">1871 diskutierte Darwin in The Descent of Man, and Selection in Relation to Sex (Die Abstammung des Menschen und die geschlechtliche Zuchtwahl) mit der sexuellen Selektion einen zweiten Selektionsmechanismus und nutzte seine Theorie, um die Abstammung des Menschen zu erklären. In seinem letzten Lebensjahrzehnt untersuchte Darwin Kletterpflanzen, Orchideen und fleischfressende Pflanzen und leistete wichtige Beiträge zur Botanik. Sein offizielles botanisches Autorenkürzel lautet „Darwin“.</p>		
						</div>
					</div>
				</div>
		</div>
		
	</body>
</html>
