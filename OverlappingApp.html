<html>
	<head>
		<title>
			Overlapping Annotations
		</title>
		
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		
		<!--
		The jQuery selectionPlugin is copied from the JavaSriptMVC Project
		[http://javascriptmvc.com/]. It's an easy way to get/set the boundaries
		as indexies of selected text. It works with all elements, also 
		across multiple elements. Now every jQuery object has th additionally
		function .selection() and .selection(start, end). To get the selection
		function running, it depends on range.js and compare.js.
		-->
		<script type="text/javascript" src="js/selectionPlugin/selection.js"></script>
		<script type="text/javascript" src="js/selectionPlugin/range.js"></script>
		<script type="text/javascript" src="js/selectionPlugin/compare.js"></script>
		
		<!--
		The jQuery wrapSelection Plugin [http://archive.plugins.jquery.com/project/wrapSelection]
		makes it possible to easily wrap an span element around an selected
		text. It also works with selections, which are spread across multiple
		elements, so it's generating the affordable amount of span tags,
		which can be styled with CSS. To avoid conflicts betweet the two
		plugins the Range in wrapSelection is now calles WSrange.
		-->
		<script type="text/javascript" src="js/wrapSelectionPlugin/jquery.wrapSelection.js"></script>
		
		<!--
		This jQuery plugin can be found on github. 
		[https://github.com/davatron5000/Lettering.js] Its used for
		getting a hovering effect on single words, to make selections
		easier for the user.
		-->
		<script type="text/javascript" src="js/jquery.lettering-0.6.1.min.js"></script>
		
		<!--
		My own written stuff for concept bars.-->
		<script type="text/javascript" src="js/conceptBars/bars.js"></script>
		
		
		<link rel="stylesheet" type="text/css" href="skeleton/base.css" />
		<link rel="stylesheet" type="text/css" href="skeleton/layout.css" />
		<link rel="stylesheet" type="text/css" href="skeleton/skeleton.css" />
		<link rel="stylesheet" type="text/css" href="layout.css" />
		
		<script type='text/javascript'>
			
			var savedClick;
			
			// Start Element, while selecting text.
			var startElement;
			var endElement;
			
			var selecting = false;
		
		$(document).ready(function(){
			
			// deals with STRG+ and STRG- and STRG0
			$(window).keydown(function(event) {
			  if(event.ctrlKey && event.keyCode == 189) { 
				console.log("Hey! Ctrl+- event captured!");
				event.preventDefault(); 
			  }
			  if(event.ctrlKey && event.keyCode == 187) { 
				console.log("Hey! Ctrl++ event captured!");
				event.preventDefault(); 
			  }
			  if(event.ctrlKey && event.keyCode == 48) { 
				console.log("Hey! Ctrl++ event captured!");
				event.preventDefault(); 
			  }
			});
			
			// hover-effect for single words
			$(".word_split").lettering('words');
			
			// hover-effect on subcategories
			$("li").hover(
				function () {
					$(this).addClass("hover");},
				function () {
					$(this).removeClass("hover");}
			);
			
			// creating a new annotation
			$("li").click(function(){	
								
				// add new atom to the atomList, with category and
				// subcategory
				// TODO: look after subcategory
				var category = $(this).parent().parent().attr('id');
				var subcategory = 0;

				addAtomToAtomList(category, savedClick["start"], savedClick["end"]);
				
				// creating a corresponding boy, which highlights the text
				// belonging to a bar
				addBoxToBoxList(savedClick["start"], savedClick["end"]);
				
				// render all bars again and display them
				savedClick = null;
				reset();
				render();
				display();
			});
			
			// for saving the start/end positions of the selected tex
			$("#text").mouseup(function(){			
				
				// save the click
				var selectedText = $("#text").selection();
				savedClick = {
					"start":selectedText.start,
					"end":selectedText.end
					};
			});
			
			
			
			
			
			
			
			
			
			
			
			$("#text .word_split span").mousedown(function(){
				
				console.log("wordSplit mouseDown");
				
				if(startElement && endElement){
					startElement.removeClass("permanentHover");
					endElement.removeClass("permanentHover");
				}	
				
				selecting = true;
				startElement = $(this);
				// TDOD: this has to be removed! Again after choosing
				// a category!
				$(this).addClass("permanentHover");
			});
			
			$("#text .word_split span").mouseup(function(){
				
				console.log("wordSplit mouseUp");
				
				selecting = false;
				endElement = $(this);
				// TDOD: this has to be removed! Again after choosing
				// a category!
				$(this).addClass("permanentHover");
			});	
			
			$("html").click(function(){
				
				console.log("html click");
				
				if(!selecting && startElement && endElement){
					startElement.removeClass("permanentHover");
					endElement.removeClass("permanentHover");
				}	
			});
			
			$("#body").mousedown(function(){
				
				console.log("body mouseDown");
				if (startElement && endElement){
					startElement.removeClass("permanentHover");
					endElement.removeClass("permanentHover");
				}
			});
		});
		</script>
	</head>

	<body>		
		
		<div class="container">
			
				<div class="sixteen columns" style="margin-bottom: 8px; margin-top: 8px;">
						<h2 style="display:inline">overlap</h2>
						<h5 style="display:inline; margin-left:8px;">visualizing overlapping annotations in text.</h5>
				</div>
				
				
				
				<div class="sixteen columns" id="body">
				
					<div class="four columns alpha">
						...
					</div>
				
					<div class="twelve columns omega">
						
						<div class="six columns alpha">
							<div class="category three columns alpha" id="A">
								<h5>Category A</h5>
								<ul>
									<li>Subcategory 1</li>
									<li>Subcategory 2</li>
									<li>Subcategory 3</li>
								</ul>							
							</div>
							<div class="category three columns omega" id="B">
								<h5>Category B</h5>
								<ul>
									<li>Subcategory 1</li>
									<li>Subcategory 2</li>
									<li>Subcategory 3</li>
									<li>Subcategory 3</li>
								</ul>
							</div>
						</div>
						
						<div class="six columns omega">
							
							<div class="category three columns alpha" id="C">
								<h5>Category C</h5>
								<ul>
									<li>Subcategory 1</li>
									<li>Subcategory 2</li>
								</ul>
							</div>
							
							<div class="category three columns omega" id="D">
								<h5>Category D</h5>
								<ul>
									<li>Subcategory 1</li>
									<li>Subcategory 2</li>
									<li>Subcategory 3</li>
									<li>Subcategory 4</li>
									<li>Subcategory 5</li>
								</ul>
							</div>											
						</div>															
					</div>
				</div>
				
				<div class="sixteen columns">
					
					<div class="four columns alpha">
						...
					</div>
					
					<!-- This is the div for the text, which is going to be annotated.-->
					<div class="twelve columns omega">
						<h2>Text Heading</h2>
						<div id="text">
							<p class="word_split">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt.</p>
							<p class="word_split">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna liquyam erat, sed diam voluptua.</p>
							<p class="word_split">At vero eos et accusam et justo duo dolores et ea rebum. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et.</p>
						</div>
					</div>
				</div>
		</div>
		
	</body>
</html>
